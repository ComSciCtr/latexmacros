%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% dynlearn.sty
%
% A style file for papers by the Crutchfield group
%
% This document is broken in to many section, seperated by concept and
% libraries required.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Basic imports

\usepackage{etex}                        %
\usepackage{ifpdf}                       % write flexible commands
\usepackage{xspace}                      % let macros play nice with spaces
\usepackage{xcolor}                      % colors
\usepackage{setspace}                    %

% figures
\usepackage{graphicx}                    %
\usepackage[caption=false]{subfig}       % subfigures; caption and subcaption
                                         % are incompatible with revtex4.1

% formatting of particular things
\usepackage[final,pagebackref]{hyperref} %
\usepackage[capitalise]{cleveref}        % Automatically label references
\usepackage{url}                         %
\usepackage[super]{nth}                  % 1st, 2nd, etc
\usepackage{contour}                     % draw an outline around text
\usepackage[abbreviations]{foreign}      % \ie, \eg.
\usepackage{verbatim}                    %

% math formating, fonts, and symbols
\usepackage{amsmath}                     %
\usepackage{amscd}                       %
\usepackage{amsfonts}                    %
\usepackage{amssymb}                     %
\usepackage{amsthm}                      %
\usepackage{bm}                          % bold
\usepackage{bbm}                         % more bold
\usepackage{mathtools}                   % mathclap, etc
\usepackage{etoolbox}                    %
\usepackage{textcomp}                    %
\usepackage{stmaryrd}                    % some computer science symbols
\usepackage{nicefrac}                    % pretty fractions
\usepackage[binary-units]{siunitx}       % format units including bits

% generic packages for nicer fonts
\usepackage[T1]{fontenc}                 % allow copy/paste of unicode
\usepackage{lmodern}                     % nicer looking font
\usepackage[scaled=0.72]{beramono}       % more nicer fonts
\usepackage{microtype}                   % friendlier word spacing

% format algorithms in pseudocode
\usepackage{algorithm}                   %
\usepackage{algorithmicx}                % algorithmic doesn't work with revtex

% better tables
\usepackage{booktabs}                    % nicer tables
\usepackage{dcolumn}                     % align by decimal in tables


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TikZ related imports

\usepackage{tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{automata}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{external}
\usetikzlibrary{intersections}
\usetikzlibrary{patterns}
\usetikzlibrary{plotmarks}
\usetikzlibrary{positioning}
\usetikzlibrary{through}

%% Externalization of TikZ images
% Uncomment to enable:

% \tikzexternalize
% \tikzsetexternalprefix{images/}

% e-Machine style and supporting code
\input{vaucanson.tikz}

%% pgfplots
\usepackage{pgfplots}
\usepgfplotslibrary{fillbetween}
\usepgfplotslibrary{groupplots}
\usepgfplotslibrary{units}
\pgfplotsset{compat=newest}

%% Useful TikZ code

% Arc along a curve, stolen from http://tex.stackexchange.com/a/71596/66712
\tikzset{
  anticlockwise arc centered at/.style={
    to path={
      let \p1=(\tikztostart), \p2=(\tikztotarget), \p3=(#1) in
      \pgfextra{
        \pgfmathsetmacro{\anglestart}{atan2(\x1-\x3,\y1-\y3)}
        \pgfmathsetmacro{\angletarget}{atan2(\x2-\x3,\y2-\y3)}
        \pgfmathsetmacro{\angletarget}%
        {\angletarget < \anglestart ? \angletarget+360 : \angletarget}
        \pgfmathsetmacro{\radius}{veclen(\x1-\x3,\y1-\y3)}
      }
      arc(\anglestart:\angletarget:\radius pt) -- (\tikztotarget)
    },
  },
  clockwise arc centered at/.style={
    to path={
      let \p1=(\tikztostart), \p2=(\tikztotarget), \p3=(#1) in
      \pgfextra{
        \pgfmathsetmacro{\anglestart}{atan2(\x1-\x3,\y1-\y3)}
        \pgfmathsetmacro{\angletarget}{atan2(\x2-\x3,\y2-\y3)}
        \pgfmathsetmacro{\angletarget}%
        {\angletarget > \anglestart ? \angletarget - 360 : \angletarget}
        \pgfmathsetmacro{\radius}{veclen(\x1-\x3,\y1-\y3)}
      }
      arc(\anglestart:\angletarget:\radius pt)  -- (\tikztotarget)
    },
  },
}

% Dynamically add plot labels to the legend, commented out because it is
% incompatible with the standard legend code

% \pgfplotsset{
%     legend entry/.initial=,
%     every axis plot post/.code={%
%         \pgfkeysgetvalue{/pgfplots/legend entry}\tempValue
%         \ifx\tempValue\empty
%             \pgfkeysalso{/pgfplots/forget plot}%
%         \else
%             \expandafter\addlegendentry\expandafter{\tempValue}%
%         \fi
%     },
% }

% Some tricky I-diagram code, if useful

\def \idiagramsetup {
  \def \radius {1.5}
  \def \delt {2}
  \def \diff {0.04}

  \coordinate (A) at (0, 0);
  \coordinate (B) at (240:\delt);
  \coordinate (C) at (-60:\delt);
  \coordinate (D) at ($ (C) ! 0.33 ! 30:(A) $);
  \coordinate (T) at ($ (A) ! \radius ! (0, 1) $);
  \coordinate (center) at (barycentric cs:A=1/3,B=1/3,C=1/3);

  \path [ultra thick, name path=present] (A) circle (\radius);
  \path [ultra thick, name path=fcsz]    (B) circle (\radius);
  \path [ultra thick, name path=rcso]    (C) circle (\radius);

  \path [name intersections={of=present and rcso, by={i1, i2}}];
  \path [name intersections={of=fcsz and rcso, by={i3, i4}}];
  \path [name intersections={of=fcsz and present, by={i5, i6}}];

  \path [ultra thick, name path=fcso, line join=round, green] ($ (i2) ! \diff ! (A) $) to
        [anticlockwise arc centered at=D] ($ (i4) ! \diff ! (B) $) to
        [anticlockwise arc centered at=B] ($ (i5) ! \diff ! (B) $) to
        [clockwise arc centered at=i5] ($ (i5) ! \diff ! (A) $) to
        [anticlockwise arc centered at=A] ($ (i2) ! \diff ! (A) $);

  \path [name intersections={of=fcso and fcsz, by={i7, i8}}];
  \path [name intersections={of=fcso and present, by={i9, i10}}];
}

\def \ipresent { (A) circle (\radius) }
\def \fcsz { (B) circle (\radius) }
\def \fcso {
  [line join=round] ($ (i2) ! \diff ! (A) $) to
  [anticlockwise arc centered at=D] ($ (i4) ! \diff ! (B) $) to
  [anticlockwise arc centered at=B] ($ (i5) ! \diff ! (B) $) to
  [clockwise arc centered at=i5] ($ (i5) ! \diff ! (A) $) to
  [anticlockwise arc centered at=A] ($ (i2) ! \diff ! (A) $)
}
\def \rcso { (C) circle (\radius) }

\def \labelpresent { \node at ($ (center) ! 2.6 ! (A) $) {\H{\textcolor{pres_color}{\Present}}} }
\def \labelfcsz { \node at ($ (center) ! 2.85 ! (B) $) {\H{\textcolor{past_color}{\FCS_0}}} }
\def \labelrcso { \node at ($ (center) ! 2.85 ! (C) $) {\H{\textcolor{futu_color}{\RCS_1}}} }
\def \labelfcso { \node at ($ (center) ! 1.5 ! (i2) $) {\H{\FCS_1}} }

\def \locationa { ($ (i3) ! 0.5 ! (T) $) }
\def \locationb { ($ (i3) ! 0.15 ! (T) $) }
\def \locationc { (barycentric cs:i6=5/12,i7=7/24,i9=7/24) }
\def \locationd { (barycentric cs:i1=1/5,i3=1/5,i7=3/10,i9=3/10) }
\def \locatione { (barycentric cs:i1=1/3,i3=1/3,i5=1/3) }
\def \locationf { (barycentric cs:i2=5/12,i3=7/24,i5=7/24) }
\def \locationg { ($ (i1) ! 0.55 ! (B) $) }
\def \locationh { (barycentric cs:i1=7/24,i4=5/12,i5=7/24) }
\def \locationi { ($ (i1) ! 2 ! (B) $) }
\def \locationj { ($ (i5) ! 1.6 ! (C) $) }
\def \locationk { (barycentric cs:i5=5/12,i7=7/24,i9=7/24) }
\def \locationl { (barycentric cs:i2=1/2,i5=1/5,i7=3/10) }
\def \locationm { (barycentric cs:i4=1/2,i5=1/5,i9=3/10) }
\def \locationn { (barycentric cs:i1=7/24,i3=7/24,i6=5/12) }
\def \locationo { ($ (i1) ! 1.6 ! (B) $) }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% colors

\colorlet {past_color}    {red}
\colorlet {pres_color}    {blue}
\colorlet {futu_color}    {black!30!green}

\colorlet {temp_color_1}  {red!50!blue}
\colorlet {temp_color_2}  {red!50!green}
\colorlet {temp_color_3}  {blue!50!green}

\colorlet {hmu_color}     {blue!67!green}
\colorlet {rhomu_color}   {temp_color_1!80!blue}
\colorlet {rmu_color}     {blue}
\colorlet {bmu_1_color}   {temp_color_1}
\colorlet {bmu_2_color}   {temp_color_3}
\colorlet {qmu_color}     {temp_color_1!67!green}
\colorlet {wmu_color}     {temp_color_2!57!blue}
\colorlet {sigmamu_color} {temp_color_2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Used for code samples

\usepackage{listings}
\lstdefinestyle{mypython}{
language=Python,                        % Code langugage
basicstyle=\small\ttfamily,             % Code font, Examples: \footnotesize, \ttfamily
keywordstyle=\color{green!50!black},    % Keywords font ('*' = uppercase)
commentstyle=\color{gray},              % Comments font
numbers=left,                           % Line nums position
numberstyle=\tiny,                      % Line-numbers fonts
stepnumber=1,                           % Step between two line-numbers
numbersep=5pt,                          % How far are line-numbers from code
backgroundcolor=\color{gray!10},        % Choose background color
frame=none,                             % A frame around the code
tabsize=2,                              % Default tab size
captionpos=b,                           % Caption-position = bottom
breaklines=true,                        % Automatic line breaking?
breakatwhitespace=false,                % Automatic breaks only at whitespace?
showspaces=false,                       % Dont make spaces visible
showtabs=false,                         % Dont make tabls visible
morekeywords={as},                      % Additional keywords
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Various theorem styles

\theoremstyle{plain}    \newtheorem{Lem}{Lemma}
\theoremstyle{plain}    \newtheorem*{ProLem}{Proof}
\theoremstyle{plain}    \newtheorem{Cor}{Corollary}
\theoremstyle{plain}    \newtheorem*{ProCor}{Proof}
\theoremstyle{plain}    \newtheorem{The}{Theorem}
\theoremstyle{plain}    \newtheorem*{ProThe}{Proof}
\theoremstyle{plain}    \newtheorem{Prop}{Proposition}
\theoremstyle{plain}    \newtheorem*{ProProp}{Proof}
\theoremstyle{plain}    \newtheorem*{Conj}{Conjecture}
\theoremstyle{plain}    \newtheorem*{Rem}{Remark}
\theoremstyle{plain}    \newtheorem{Def}{Definition}
\theoremstyle{plain}    \newtheorem*{Not}{Notation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Finally, computational mechanics and information theory macros

\input{cmechabbrev}
\input{infotheory}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Uncomment to list package versions:
% \listfiles

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Document configuration

\setlength{\parindent}{0pt}
\newcommand{\alert}[1]{\textbf{\textcolor{red}{#1}}}

\hypersetup{
  colorlinks,
  linkcolor={blue!50!black},
  citecolor={blue!50!black},
  urlcolor={blue!80!black},
}

% working paper commands
\newcommand{\arxiv}[1]{\href{http://arxiv.org/abs/#1}{\texttt{arXiv}:#1}}
% SFI working papers do not have friendly URLs:
\newcommand{\sfiwp}[1]{Santa Fe Institute Working Paper #1}
